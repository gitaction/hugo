<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="DDD Hugo 配置信息 # 在用DDD来驱动Hugo配置信息开发之前，让我们先来回顾一下 Hugo源码精读 配置中所描述到的主要实现思路。
将配置文件config.toml转换成map:
再将默认配置信息加入其中
收集模块配置信息
通过这些处理后，我们就能准备好完整的配置信息了。
但在静态站点生成领域里，又需要怎么样去组织这些对象，才能让大家协同并高效合作呢？
Hugoverse Config 信息流 # 先来看看在交六边型架构的Hugoverse中，Config模块是如何和处部交互的：
➜ hugoverse git:(main) ~/go/bin/dp normal -m ./ -p github.com/dddplayer/hugoverse/internal/domain/config -mf 线上可缩放版本可 点这里查看。
从图中可看到Config模块主要是通过实体Config的Load方法对外提供服务的，主要调用路径有两条：
main -> cmd/New -> interface/buildCmd.Run -> application/GenerateStaticSite -> entity/Config.Load main -> cmd/New -> interface/serverCmd.Run -> interface/api/NewServer -> interface/api/Server.registerHandler -> interface/api/Server.handleConfig -> application/AllConfigurationInformation -> entity/Config.Load 第一条是用来构建静态站点的，通过提供的应用服务GenerateStaticSite发起的调用。
第二条则是用来提供Headless CMS API服务发起的，通过提供的应用服务AllConfigurationInformation发起的调用。
Config 内部组织结构 # 看完了流程图后，我们理解到外部和Config模块是怎么交互的。 接下来让我们一起来看看Config模块的内部组成。
➜ hugoverse git:(main) ✗ ~/go/bin/dp normal -m ."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="4.3 DDD配置信息"><meta property="og:description" content="DDD Hugo 配置信息 # 在用DDD来驱动Hugo配置信息开发之前，让我们先来回顾一下 Hugo源码精读 配置中所描述到的主要实现思路。
将配置文件config.toml转换成map:
再将默认配置信息加入其中
收集模块配置信息
通过这些处理后，我们就能准备好完整的配置信息了。
但在静态站点生成领域里，又需要怎么样去组织这些对象，才能让大家协同并高效合作呢？
Hugoverse Config 信息流 # 先来看看在交六边型架构的Hugoverse中，Config模块是如何和处部交互的：
➜ hugoverse git:(main) ~/go/bin/dp normal -m ./ -p github.com/dddplayer/hugoverse/internal/domain/config -mf 线上可缩放版本可 点这里查看。
从图中可看到Config模块主要是通过实体Config的Load方法对外提供服务的，主要调用路径有两条：
main -> cmd/New -> interface/buildCmd.Run -> application/GenerateStaticSite -> entity/Config.Load main -> cmd/New -> interface/serverCmd.Run -> interface/api/NewServer -> interface/api/Server.registerHandler -> interface/api/Server.handleConfig -> application/AllConfigurationInformation -> entity/Config.Load 第一条是用来构建静态站点的，通过提供的应用服务GenerateStaticSite发起的调用。
第二条则是用来提供Headless CMS API服务发起的，通过提供的应用服务AllConfigurationInformation发起的调用。
Config 内部组织结构 # 看完了流程图后，我们理解到外部和Config模块是怎么交互的。 接下来让我们一起来看看Config模块的内部组成。
➜ hugoverse git:(main) ✗ ~/go/bin/dp normal -m ."><meta property="og:type" content="article"><meta property="og:url" content="https://hugo.notes.sunwei.xyz/docs/chapter/04/config/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-11-29T19:39:27+08:00"><title>4.3 DDD配置信息 | Deep Dive into Hugo: Becoming an Expert in the Static Site Generator Domain</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/zh.search.min.55f97a5530477070642c976641f28394e368a01653382589e52a553c8ec9e07b.js integrity="sha256-Vfl6VTBHcHBkLJdmQfKDlONooBZTOCWJ5SpVPI7J4Hs=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-STPKPBQR5Y"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-STPKPBQR5Y",{anonymize_ip:!1})}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Deep Dive into Hugo: Becoming an Expert in the Static Site Generator Domain</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Chinese</a></label><ul><li><a href=https://hugo.notes.sunwei.xyz/en/>English</a></li></ul></li></ul><ul><li><p><a href=/docs/introduction/><strong>引言</strong></a><br></p></li><li><p><a href=/docs/chapter/01/><strong>第一章 Hugo入门</strong></a></p><ul><li><a href=/docs/chapter/01/ssg/>1.1 静态站点的背景和重要性</a></li><li><a href=/docs/chapter/01/hugo/>1.2 Hugo简介</a></li><li><a href=/docs/chapter/01/install/>1.3 安装Hugo</a></li><li><a href=/docs/chapter/01/site/>1.4 创建第一个站点</a></li><li><a href=/docs/chapter/01/theme/>1.5 自定义主题</a></li><li><a href=/docs/chapter/01/sunweixyz/>1.6 个人站点实例</a><ul><li><a href=/docs/chapter/01/sunweixyz/site/>个人站点</a></li><li><a href=/docs/chapter/01/sunweixyz/theme/>创建新主题</a></li><li><a href=/docs/chapter/01/sunweixyz/deploy/>部署GitHub Pages</a></li></ul></li><li><a href=/docs/chapter/01/qa/>1.7 常见问题和资源</a><br></li></ul></li><li><p><strong>第二章 DDD简介</strong></p><ul><li><a href=/docs/chapter/02/ddd/>2.1 DDD简介</a></li><li><a href=/docs/chapter/02/dddplayer/>2.2 DDD在本书中的应用</a><br></li></ul></li><li><p><a href=/docs/chapter/03/><strong>第三章 Hugo源码精读</strong></a></p><ul><li><a href=/docs/chapter/03/read/>3.1 源码阅读步骤介绍</a></li><li><a href=/docs/chapter/03/prerequisite/>3.2 Hugo本地环境搭建</a></li><li><a href=/docs/chapter/03/dddplayer/>3.3 安装DDDPlayer</a></li><li><a href=/docs/chapter/03/arch/>3.4 Hugo架构设计</a></li><li><a href=/docs/chapter/03/code/>3.5 Hugo源码精读</a><ul><li><a href=/docs/chapter/03/code/config/>3.5.1 配置</a></li><li><a href=/docs/chapter/03/code/deps/>3.5.2 依赖</a><ul><li><a href=/docs/chapter/03/code/deps/pathSpec/>3.5.2.1 PathSpec</a></li><li><a href=/docs/chapter/03/code/deps/contentSpec/>3.5.2.2 ContentSpec</a></li></ul></li><li><a href=/docs/chapter/03/code/site/>3.5.3 站点</a><ul><li><a href=/docs/chapter/03/code/site/create/>3.5.3.1 创建</a></li><li><a href=/docs/chapter/03/code/site/load/>3.5.3.2 加载</a></li><li><a href=/docs/chapter/03/code/site/markdown/>3.5.3.3 Markdown</a></li></ul></li><li><a href=/docs/chapter/03/code/build/>3.5.4 构建</a><ul><li><a href=/docs/chapter/03/code/build/template/>3.5.4.1 模板</a><br></li></ul></li></ul></li></ul></li><li><p><a href=/docs/chapter/04/><strong>第四章 DDD Hugo</strong></a></p><ul><li><a href=/docs/chapter/04/hugoverse/>4.1 Hugoverse</a></li><li><a href=/docs/chapter/04/demo/>4.2 Hugo 样例工程</a></li><li><a href=/docs/chapter/04/hexagon/>4.3 Hugoverse 六边形架构</a></li><li><a href=/docs/chapter/04/config/ class=active>4.4 DDD Hugo 配置信息</a><br></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/sunwei/hugo-book target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>4.3 DDD配置信息</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ddd-hugo-配置信息>DDD Hugo 配置信息</a><ul><li><a href=#hugoverse-config-信息流>Hugoverse Config 信息流</a></li><li><a href=#config-内部组织结构>Config 内部组织结构</a></li><li><a href=#config-ddd-战略图>Config DDD 战略图</a></li><li><a href=#config-ddd-战术图>Config DDD 战术图</a></li><li><a href=#小结>小结</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=ddd-hugo-配置信息>DDD Hugo 配置信息
<a class=anchor href=#ddd-hugo-%e9%85%8d%e7%bd%ae%e4%bf%a1%e6%81%af>#</a></h1><p>在用DDD来驱动Hugo配置信息开发之前，让我们先来回顾一下
<a href=/docs/chapter/03/code/config/>Hugo源码精读 配置</a>中所描述到的主要实现思路。</p><p><strong>将配置文件config.toml转换成map:</strong></p><p><img src=images/8.1-LoadConfig-toml-to-map.svg alt="config - map"></p><p><strong>再将默认配置信息加入其中</strong></p><p><img src=images/8.3-LoadConfig-config.svg alt="config provider"></p><p><strong>收集模块配置信息</strong></p><p><img src=images/8.6-LoadConfig-collectModules.svg alt="collect modules"></p><p>通过这些处理后，我们就能准备好完整的配置信息了。</p><p>但在静态站点生成领域里，又需要怎么样去组织这些对象，才能让大家协同并高效合作呢？</p><h2 id=hugoverse-config-信息流>Hugoverse Config 信息流
<a class=anchor href=#hugoverse-config-%e4%bf%a1%e6%81%af%e6%b5%81>#</a></h2><p>先来看看在交六边型架构的Hugoverse中，Config模块是如何和处部交互的：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  hugoverse git:<span style=color:#f92672>(</span>main<span style=color:#f92672>)</span> ~/go/bin/dp normal -m ./ -p github.com/dddplayer/hugoverse/internal/domain/config -mf
</span></span></code></pre></div><p><img src=images/ddd-config-mf.svg alt="DDD Config Message Flow"></p><p>线上可缩放版本可
<a href="https://dddplayer.com/?path=https://assets.dddplayer.com/resource/hugov/github.com.dddplayer.hugoverse.internal.domain.config.messageflow.dot">点这里</a>查看。</p><p>从图中可看到Config模块主要是通过实体Config的Load方法对外提供服务的，主要调用路径有两条：</p><ol><li>main -> cmd/New -> interface/buildCmd.Run -> application/GenerateStaticSite -> entity/Config.Load</li><li>main -> cmd/New -> interface/serverCmd.Run -> interface/api/NewServer -> interface/api/Server.registerHandler -> interface/api/Server.handleConfig -> application/AllConfigurationInformation -> entity/Config.Load</li></ol><p>第一条是用来构建静态站点的，通过提供的应用服务GenerateStaticSite发起的调用。</p><p>第二条则是用来提供Headless CMS API服务发起的，通过提供的应用服务AllConfigurationInformation发起的调用。</p><h2 id=config-内部组织结构>Config 内部组织结构
<a class=anchor href=#config-%e5%86%85%e9%83%a8%e7%bb%84%e7%bb%87%e7%bb%93%e6%9e%84>#</a></h2><p>看完了流程图后，我们理解到外部和Config模块是怎么交互的。
接下来让我们一起来看看Config模块的内部组成。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  hugoverse git:<span style=color:#f92672>(</span>main<span style=color:#f92672>)</span> ✗ ~/go/bin/dp normal -m ./ -p github.com/dddplayer/hugoverse/internal/domain/config -c
</span></span></code></pre></div><p><img src=images/ddd-config-composition.svg alt="DDD Config Composition"></p><p>线上可缩放版本可
<a href="https://dddplayer.com/?path=https://assets.dddplayer.com/resource/hugov/github.com.dddplayer.hugoverse.internal.domain.config.composition.dot">点这里</a>查看。</p><p>从图中可以看到：</p><ul><li>config模块在根目录定义了Provider接口，为对外提供的服务定义了明确的契约</li><li>只有一个实体，那就是Config，这个实体拥有三个属性，分别是配置文件路径Path，用于提供记录信息的Logger，和所有模块信息</li><li>值对象相对丰富<ul><li>DefaultConfigProvider，通过提供的方法可以看出，实现了Provider接口，其Root属性是Params类型，用以支持对外提供的方法</li><li>Module是一个接口，定义了每个Module需要提供Mounts, Config和Owner信息，因为这里的模块指的是Theme，而Theme是可嵌套的</li><li>收集Module信息还需要一个收集器，那就是ModuleCollector，这个收集器的唯一属性就是Modules</li></ul></li></ul><p>这样一来，我们就能大致了解到Config模块内部是如何组织，协同工作的。</p><p>先定义接口，大家商量好后，就可以各自忙各自的了。
外部模块 - 应用可以知道怎么了解到Config模块可以提供哪些服务（Provider - Set, Get, GetString, SetDefaults）。
Config模块内部也可以自己决定要怎么去实现，并提供这些服务。
就像面向对象里的依赖反转原则 - 谁提供服务，谁定义接口。</p><p>明确了职责后，Config决定由实体对象Config来提供加载Load的功能，并返回接口Provider服务，这需要一个实现对象，那就是值对象DefaultConfigProvider。</p><p>在加载的过程中，需要一些外部信息，像配置文件路径信息。
有了这些信息后，实体Config就按自己的节奏来进行处理了。
从私有的方法可以看出，Config需要从本地加载配置文件 - loadConfigFromDisk，再加载模块信息loadModules，其中加载模块时，用到了值对象模块收集器。</p><p>在大家的配合下，最终实现了最开始的承诺 - 提供Provider服务。</p><h2 id=config-ddd-战略图>Config DDD 战略图
<a class=anchor href=#config-ddd-%e6%88%98%e7%95%a5%e5%9b%be>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  hugoverse git:<span style=color:#f92672>(</span>main<span style=color:#f92672>)</span> ✗ ~/go/bin/dp strategic -m ./ -p github.com/dddplayer/hugoverse                    
</span></span></code></pre></div><p><img src=images/ddd-config-strategic.svg alt="DDD Config Strategic"></p><p>线上可缩放版本可
<a href="https://dddplayer.com/?path=https://assets.dddplayer.com/resource/hugov/github.com.dddplayer.hugoverse.strategic.config.dot">点这里</a>查看。</p><p>果然如我们所料：</p><ul><li>实体Config也是聚合根，对外提供服务，并帮助内部成员专注在内部实现</li><li>值对象DefaultConfigProvider是实现了Provider接口的重要对象</li><li>值对象ModuleCollector用moduleAdapter帮忙组织了ModuleConfig，并把Import和Mount信息都准备好<ul><li>Import指的是模块需要引入哪些模块，像我们的样例工程引用了Theme主题</li><li>Mount指的是挂载点，当我们准备好一些引入的模块后，我们怎么把相关的内容，如layouts的文件都挂载到相应的位置，为后面的渲染准备好模板</li></ul></li></ul><h2 id=config-ddd-战术图>Config DDD 战术图
<a class=anchor href=#config-ddd-%e6%88%98%e6%9c%af%e5%9b%be>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>➜  hugoverse git:<span style=color:#f92672>(</span>main<span style=color:#f92672>)</span> ✗ ~/go/bin/dp tactic -m ./ -p github.com/dddplayer/hugoverse -d                    
</span></span></code></pre></div><p><img src=images/ddd-config-tactic-detail.svg alt="DDD Config Strategic"></p><p>线上可缩放版本可
<a href="https://dddplayer.com/?path=https://assets.dddplayer.com/resource/hugov/github.com.dddplayer.hugoverse.tactic.detail.config.dot">点这里</a>查看。</p><p>DDD战略图可以帮助我们直观的查看领域对象，以及对象之间的关联关系，以保证大家用的都是同一语言 - 统一语言。
这样无论是在敏捷迭代IPM拉通等会议上，还是在架构设计的过程中，都能让消息高效准确的在团队内流通。</p><p>而在代码评审的时候，光有DDD战略图是不够的，还需要DDD战术图。
用以帮助大家理解代码实现的细节，团队就可以在这一过程中发现我们的代码实现是否符合架构的一些规则，如DDD强调不能由聚合根之外的内部对象对外提供服务等。</p><p>在上图中，我们可以看到：</p><ul><li>确实是DefaultConfigProvider实现了Provider，有一条表示接口实现的虚线</li><li>聚合根对外提供的Load方法，分别调用了内部的loadConfigFromDisk和loadModules方法</li><li>moduleAdapter的owner属性就是Module接口对象，自己也实现了Module接口</li></ul><p>小技巧：我们可以用鼠标hover上这些线条获取更详细的信息，如下图所示：</p><p><img src=images/module-hover.png alt="dddplayer hover"></p><h2 id=小结>小结
<a class=anchor href=#%e5%b0%8f%e7%bb%93>#</a></h2><p>通过阅读Hugo源码，我们能理解Hugo的设计思路，并懂得Hugo是如何一步步实现这些功能的。</p><p>如果我们想把这些知识应用到工作生活中，我们还需要把这些零碎的领域知识组装成一副清晰的领域全景图。</p><p>在DDD所推荐的六边型架构中，我们能很明确的知道什么样的功能需要放在哪些目录下。
这正是这种架构框架带给我们的好处 - 先定义职责，形成共识，写代码的时候就知道我们需要把这些功能代码分别放置在哪里。</p><p>有了框架的帮助，我们借助DDDPlayer的Message Flow功能，可以看到Config模块是如何和处部进行交互的，又是谁充当着处交官的角色，那她将会是聚合根的首先。</p><p>有了清晰的职责划分，再用DDDPlayer的Composition功能，可以了解到Config模块是具体怎么组织内部的对象的，这又帮助我们了解到了更多的细节。</p><p>在DDD中，既要懂战略，也要懂战术。</p><p>战略指导我们要怎么做，有哪些关键对象需要明确出来。
而战术就能告知我们该怎么具体实现，如何动手实践。</p><p>战略结合战术，首先能让我们统一语言，知道在家说的一个个名词都是什么意思，让信息不失真，达到高效沟通的目的。
也让我们明确了实现细节，有问题也可以及时沟通，及时发现。</p><p>Config模块的策略就是由Config这个聚合根对外提供统一的服务，由DefaultConfigProvider来提供提前协商的接口服务。
并由ModuleCollector这个帮手来收集经过moduleAdapter适配器处理过的模块相关信息。</p><p>战术上Config模块也是遵循战略指导，提供了一些功能函数和方法具体实现了Config模块秘定义的功能服务。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/sunwei/hugo-notes/commit/aa67647756b9404f782c7b0a3203f75b6008593c title='最后修改者 sunwei | November 29, 2023' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 29, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/sunwei/hugo-notes/edit/main/content.zh/docs/chapter/04/config/index.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>编辑本页</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#ddd-hugo-配置信息>DDD Hugo 配置信息</a><ul><li><a href=#hugoverse-config-信息流>Hugoverse Config 信息流</a></li><li><a href=#config-内部组织结构>Config 内部组织结构</a></li><li><a href=#config-ddd-战略图>Config DDD 战略图</a></li><li><a href=#config-ddd-战术图>Config DDD 战术图</a></li><li><a href=#小结>小结</a></li></ul></li></ul></nav></div></aside></main></body></html>