<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="onCreated # Deps新建后，我们就可以应用Deps了。 在新建HugoSites的流程中，可以看到应用Deps的操作发生在onCreated中。
了然于胸 - onCreate时序图 # 从左下角可以看出，onCreate主要分为三部分，分别是：
NewDestinationPublisher: 为站点创建publisher initializeSiteInfo：初始化站点信息，将站点所依赖的信息都汇集到一块 newPageCollection：创建页面集合，因为最终渲染是以页面为单位，所以在HugoSites中为每个站点都配备了一个聚集器 NewDestinationPublisher # pub, err := publisher.NewDestinationPublisher( d.ResourceSpec, s.outputFormatsConfig, s.mediaTypesConfig, ) ... s.publisher = pub ResourceSpec来自于Deps，其中包含了全面文件系统信息的PathSpec，和outputFormats, mediaTypesConfig，在我们的例子里，都是默认配置。 而在publisher中，我们不拥有当前site拥有的配置信息 - outputFormatsConfig, mediaTypesConfig。 同时拥有默认信息和定制化信息，这样我们就可以针对当前site进行定制化处理了。
initializeSiteInfo # func (s *Site) initializeSiteInfo() error { // Assemble dependencies to be used in hugo.Deps. s.Info = &SiteInfo{ title: &#34;title&#34;, relativeURLs: s.Cfg.GetBool(&#34;relativeURLs&#34;), owner: s.h, s: s, } return nil } 在我们的例子中对基本信息做了简化，可以看到，这里会对站点所需要的基本信息，像标题等等进行汇总。
newPageCollection # ... pm := &pageMap{ contentMap: newContentMap(), s: s, } s."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="onCreated # Deps新建后，我们就可以应用Deps了。 在新建HugoSites的流程中，可以看到应用Deps的操作发生在onCreated中。
了然于胸 - onCreate时序图 # 从左下角可以看出，onCreate主要分为三部分，分别是：
NewDestinationPublisher: 为站点创建publisher initializeSiteInfo：初始化站点信息，将站点所依赖的信息都汇集到一块 newPageCollection：创建页面集合，因为最终渲染是以页面为单位，所以在HugoSites中为每个站点都配备了一个聚集器 NewDestinationPublisher # pub, err := publisher.NewDestinationPublisher( d.ResourceSpec, s.outputFormatsConfig, s.mediaTypesConfig, ) ... s.publisher = pub ResourceSpec来自于Deps，其中包含了全面文件系统信息的PathSpec，和outputFormats, mediaTypesConfig，在我们的例子里，都是默认配置。 而在publisher中，我们不拥有当前site拥有的配置信息 - outputFormatsConfig, mediaTypesConfig。 同时拥有默认信息和定制化信息，这样我们就可以针对当前site进行定制化处理了。
initializeSiteInfo # func (s *Site) initializeSiteInfo() error { // Assemble dependencies to be used in hugo.Deps. s.Info = &SiteInfo{ title: &#34;title&#34;, relativeURLs: s.Cfg.GetBool(&#34;relativeURLs&#34;), owner: s.h, s: s, } return nil } 在我们的例子中对基本信息做了简化，可以看到，这里会对站点所需要的基本信息，像标题等等进行汇总。
newPageCollection # ... pm := &pageMap{ contentMap: newContentMap(), s: s, } s."><meta property="og:type" content="article"><meta property="og:url" content="https://hugo.notes.sunwei.xyz/docs/code/%E7%AB%99%E7%82%B9/%E5%88%9B%E5%BB%BA/"><meta property="article:section" content="docs"><title>Index | Deep Understanding of Hugo</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=alternate hreflang=en href=https://hugo.notes.sunwei.xyz/en/docs/code/%E7%AB%99%E7%82%B9/%E5%88%9B%E5%BB%BA/ title=Index><link rel=stylesheet href=/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/zh.search.min.1ecc359d6bd3fe3a685cff1b637cce441a384b9cb4f84087d4cd56e5ecb09365.js integrity="sha256-Hsw1nWvT/jpoXP8bY3zORBo4S5y0+ECH1M1W5eywk2U=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Deep Understanding of Hugo</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Chinese</a></label><ul><li><a href=https://hugo.notes.sunwei.xyz/en/docs/code/%E7%AB%99%E7%82%B9/%E5%88%9B%E5%BB%BA/>English</a></li></ul></li></ul><ul><li><p><strong>Hugo使用实例</strong></p></li><li><p><a href=/docs/what/%E4%B8%AA%E4%BA%BA%E7%AB%99%E7%82%B9/>创建站点</a></p></li><li><p><a href=/docs/what/%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%BB%E9%A2%98/>自定义主题</a><br></p></li><li><p><strong>Hugo架构</strong></p></li><li><p><a href=/docs/how/%E6%B8%B8%E4%B9%90%E5%9C%BA/>游乐场</a></p></li><li><p><a href=/docs/how/%E4%BA%8B%E4%BB%B6%E9%A3%8E%E6%9A%B4/>事件风暴</a></p></li><li><p><a href=/docs/how/%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84/>基础架构</a><br></p></li><li><p><a href=/docs/code/><strong>源码解析</strong></a></p></li><li><p><a href=/docs/code/%E9%85%8D%E7%BD%AE/>配置</a></p></li><li><p><a href=/docs/code/%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/>依赖管理</a></p><ul><li><a href=/docs/code/%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/%E8%B7%AF%E5%BE%84%E8%A7%84%E8%8C%83/>PathSpec</a></li><li><a href=/docs/code/%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/%E5%86%85%E5%AE%B9%E8%A7%84%E8%8C%83/>ContentSpec</a></li></ul></li><li><p><a href=/docs/code/%E7%AB%99%E7%82%B9/>站点创建</a></p><ul><li><a href=/docs/code/%E7%AB%99%E7%82%B9/%E5%88%9B%E5%BB%BA/ class=active>创建站点</a></li><li><a href=/docs/code/%E7%AB%99%E7%82%B9/%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90/>加载资源</a></li><li><a href=/docs/code/%E7%AB%99%E7%82%B9/markdown/>Markdown</a></li></ul></li><li><p><a href=/docs/code/%E6%9E%84%E5%BB%BA/>站点构建</a></p><ul><li><a href=/docs/code/%E6%9E%84%E5%BB%BA/%E6%A8%A1%E6%9D%BF/>模板执行</a><br></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/sunwei/hugo-book target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Index</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#oncreated>onCreated</a></li><li><a href=#了然于胸---oncreate时序图>了然于胸 - onCreate时序图</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h3 id=oncreated>onCreated
<a class=anchor href=#oncreated>#</a></h3><p>Deps新建后，我们就可以应用Deps了。
在新建HugoSites的流程中，可以看到应用Deps的操作发生在onCreated中。</p><h3 id=了然于胸---oncreate时序图>了然于胸 - onCreate时序图
<a class=anchor href=#%e4%ba%86%e7%84%b6%e4%ba%8e%e8%83%b8---oncreate%e6%97%b6%e5%ba%8f%e5%9b%be>#</a></h3><p><img src=images/9.0-Hugo-Sites-main.svg alt="HugoSites Main Flow"></p><p>从左下角可以看出，onCreate主要分为三部分，分别是：</p><ul><li>NewDestinationPublisher: 为站点创建publisher</li><li>initializeSiteInfo：初始化站点信息，将站点所依赖的信息都汇集到一块</li><li>newPageCollection：创建页面集合，因为最终渲染是以页面为单位，所以在HugoSites中为每个站点都配备了一个聚集器</li></ul><h4 id=newdestinationpublisher>NewDestinationPublisher
<a class=anchor href=#newdestinationpublisher>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>pub</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>publisher</span>.<span style=color:#a6e22e>NewDestinationPublisher</span>(
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>ResourceSpec</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>outputFormatsConfig</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>mediaTypesConfig</span>,
</span></span><span style=display:flex><span>			)
</span></span><span style=display:flex><span>			<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>publisher</span> = <span style=color:#a6e22e>pub</span>
</span></span></code></pre></div><p>ResourceSpec来自于Deps，其中包含了全面文件系统信息的PathSpec，和outputFormats, mediaTypesConfig，在我们的例子里，都是默认配置。
而在publisher中，我们不拥有当前site拥有的配置信息 - outputFormatsConfig, mediaTypesConfig。
同时拥有默认信息和定制化信息，这样我们就可以针对当前site进行定制化处理了。</p><h4 id=initializesiteinfo>initializeSiteInfo
<a class=anchor href=#initializesiteinfo>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Site</span>) <span style=color:#a6e22e>initializeSiteInfo</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Assemble dependencies to be used in hugo.Deps.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Info</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>SiteInfo</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>title</span>:        <span style=color:#e6db74>&#34;title&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>relativeURLs</span>: <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Cfg</span>.<span style=color:#a6e22e>GetBool</span>(<span style=color:#e6db74>&#34;relativeURLs&#34;</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>owner</span>:        <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>h</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>:            <span style=color:#a6e22e>s</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在我们的例子中对基本信息做了简化，可以看到，这里会对站点所需要的基本信息，像标题等等进行汇总。</p><h4 id=newpagecollection>newPageCollection
<a class=anchor href=#newpagecollection>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>pm</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>pageMap</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>contentMap</span>: <span style=color:#a6e22e>newContentMap</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>s</span>:          <span style=color:#a6e22e>s</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>PageCollections</span> = <span style=color:#a6e22e>newPageCollections</span>(<span style=color:#a6e22e>pm</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><p>PageCollections是页面的集合，可以提供类似于页面查找的服务。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/sunwei/hugo-notes/edit/main/content.zh/docs/code/%e7%ab%99%e7%82%b9/%e5%88%9b%e5%bb%ba/index.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>编辑本页</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#oncreated>onCreated</a></li><li><a href=#了然于胸---oncreate时序图>了然于胸 - onCreate时序图</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>